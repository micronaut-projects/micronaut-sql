<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>Micronaut SQL Libraries</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <link rel="stylesheet" href="../css/highlight/agate.css">
    <script src="../js/highlight.pack.js"></script>
    <script src="../js/guide.js"></script>
    <script src="../js/multi-language-sample.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="stylesheet" href="../css/multi-language-sample.css"/>
    <script src="../js/docs.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.13/clipboard.min.js"></script>
    <script type="text/javascript">
        function addJsClass(el) {
            var classes = document.body.className.split(" ");
            classes.push("js");
            document.body.className = classes.join(" ");
        }
    </script>

</head>

<body class="body" id="docs" onload="addJsClass();" onhashchange="highlightMenu()">

<div id="table-of-content-nav-link" class="desktop">
    <a id="theme-switcher" title="Switch to dark theme" href="javascript:switchTheme(true)"><i class="fa fa-moon-o"></i></a>
    <a title="Collapse/Open Table of contents" title="Hide Table of Contents" href="javascript:hideTableOfContents();" class="button">[ + ]</a>
</div>

<div id="main">
    <div id="navigation" class="no-print">
        <div class="navTitle">
            <span id="logo"><a href="http://micronaut.io" title="Go to Micronaut Website"><img src="../img/micronaut-logo-white.svg" alt="Micronaut"/></a></span>
        </div>
        <div class="navLinks">
            <ul>
                    <li><div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)" class="desktop">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#breaks"><strong>3</strong><span>Breaking Changes</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#jdbc"><strong>4</strong><span>Configuring JDBC</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#hibernate"><strong>5</strong><span>Configuring Hibernate</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#jasync"><strong>6</strong><span>Configuring JAsync SQL</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#jooq"><strong>7</strong><span>Configuring jOOQ</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#jdbi"><strong>8</strong><span>Configuring Jdbi</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#vertxmysqlclient"><strong>9</strong><span>Configuring Reactive MySQL Client</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#vertxpgclient"><strong>10</strong><span>Configuring Reactive PostgreSQL Client</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#repository"><strong>11</strong><span>Repository</span></a></div>
                                
                            </div>
                        </div>
                    </li>

                <li id="table-of-content-nav-link-mobile" class="mobile">
                    <a title="Scroll to Table of contents" href="javascript:scrollToTop();" class="button">Toc</a>
                </li>
                <li class="desktop">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to API documentation" href="../api/index.html" class="button">API</a>
                </li>
                <li class="desktop">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Configuration Reference</a>
                </li>
                <li class="mobile">
                    <a title="Go to Configuration Reference documentation" href="../guide/configurationreference.html" class="button">Conf</a>
                </li>
            </ul>

        </div>
    </div>
    
    <div id="table-of-content">
        <div class="toc-content">

        <h2>Table of Contents</h2>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-introduction"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-releaseHistory"><a href="#releaseHistory"><strong>2</strong><span>Release History</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-breaks"><a href="#breaks"><strong>3</strong><span>Breaking Changes</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-jdbc"><a href="#jdbc"><strong>4</strong><span>Configuring JDBC</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbc-disable"><a href="#jdbc-disable"><strong>4.1</strong><span>Disable Micronaut JDBC Data Sources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbc-connection-pools"><a href="#jdbc-connection-pools"><strong>4.2</strong><span>Configuring JDBC Connection Pools</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbc-multiple-datasources"><a href="#jdbc-multiple-datasources"><strong>4.3</strong><span>Configuring Multiple Data Sources</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbc-healthchecks"><a href="#jdbc-healthchecks"><strong>4.4</strong><span>JDBC Health Checks</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-hibernate"><a href="#hibernate"><strong>5</strong><span>Configuring Hibernate</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-disable"><a href="#hibernate-disable"><strong>5.1</strong><span>Disable Micronaut Hibernate JPA</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-inject-session"><a href="#hibernate-inject-session"><strong>5.2</strong><span>Injecting an EntityManager or Hibernate Session</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-customizing"><a href="#hibernate-customizing"><strong>5.3</strong><span>Customizing Hibernate/JPA Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-entity-scan"><a href="#hibernate-entity-scan"><strong>5.4</strong><span>Entity Scan Configuration</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-reactive"><a href="#hibernate-reactive"><strong>5.5</strong><span>Configuring Hibernate Reactive</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-proxies"><a href="#hibernate-proxies"><strong>5.6</strong><span>Using compile-time Hibernate proxies</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-hibernate-lazy-initialization"><a href="#hibernate-lazy-initialization"><strong>5.7</strong><span>Understanding LazyInitializationException</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-jasync"><a href="#jasync"><strong>6</strong><span>Configuring JAsync SQL</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jasync-client"><a href="#jasync-client"><strong>6.1</strong><span>Configuring jasync-sql Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jasync-healthchecks"><a href="#jasync-healthchecks"><strong>6.2</strong><span>Database Health Checks</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-jooq"><a href="#jooq"><strong>7</strong><span>Configuring jOOQ</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jooq-dialect"><a href="#jooq-dialect"><strong>7.1</strong><span>Configuring SQL dialect</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jooq-provider-beans"><a href="#jooq-provider-beans"><strong>7.2</strong><span>Configuring additional provider beans</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jooq-jsonb"><a href="#jooq-jsonb"><strong>7.3</strong><span>Using JsonMapper to convert JSON(B) types</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jooq-graalvm"><a href="#jooq-graalvm"><strong>7.4</strong><span>GraalVM native image</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-jdbi"><a href="#jdbi"><strong>8</strong><span>Configuring Jdbi</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-jdbi-provider-beans"><a href="#jdbi-provider-beans"><strong>8.1</strong><span>Configuring additional provider beans</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-vertxmysqlclient"><a href="#vertxmysqlclient"><strong>9</strong><span>Configuring Reactive MySQL Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-vertxmysqlclient-healthchecks"><a href="#vertxmysqlclient-healthchecks"><strong>9.1</strong><span>MySQL Health Checks</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-vertxpgclient"><a href="#vertxpgclient"><strong>10</strong><span>Configuring Reactive PostgreSQL Client</span></a></div>
        
        <div class="toc-item" style="margin-left:10px" id="toc-item-vertxpgclient-healthchecks"><a href="#vertxpgclient-healthchecks"><strong>10.1</strong><span>PostgreSQL Health Checks</span></a></div>
        
        <div class="toc-item" style="margin-left:0px" id="toc-item-repository"><a href="#repository"><strong>11</strong><span>Repository</span></a></div>
        
        </div>
    </div>
    
    <div class="docs-content">
    <div class="project">
        <h1>Micronaut SQL Libraries</h1>
        <p></p>
        <p>Projects to support SQL Database access in Micronaut</p>
        <p><strong>Version:</strong> 5.8.1-SNAPSHOT </p>
    </div>
    
<h1 id="introduction"><a class="anchor" href="#introduction"></a>1 Introduction</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>This project includes modules to support SQL Database access in Micronaut.</p>
</div>

<h1 id="releaseHistory"><a class="anchor" href="#releaseHistory"></a>2 Release History</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/releaseHistory.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For this project, you can find a list of releases (with release notes) here:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-sql/releases">https://github.com/micronaut-projects/micronaut-sql/releases</a></p>
</div>

<h1 id="breaks"><a class="anchor" href="#breaks"></a>3 Breaking Changes</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/breaks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect1">
<h2 id="_micronaut_sql_5_8_0">Micronaut SQL 5.8.0</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Micronaut SQL 5.7.0, you could <a href="#jdbc-disable">disable data sources</a> if you set <code>datasources.enabled</code> to <code>false</code>. Since Micronaut SQL 5.8.0, it is no longer supported. If you have multiple data sources, you have to disable them all individually. For example if you had two data sources named <code>a</code> and <code>b</code>, you have to set <code>datasources.a.enabled=false</code> and    <code>datasources.b.enabled=false</code>.</p>
</div>
</div>
</div>

<h1 id="jdbc"><a class="anchor" href="#jdbc"></a>4 Configuring JDBC</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Java data sources can be configured for one of four currently provided implementations. Apache DBCP2, Hikari, Tomcat, and Oracle Universal Connection Pool are supported by default.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply one of the <code>jdbc-tomcat</code>, <code>jdbc-hikari</code>, <code>jdbc-dbcp</code>, or <code>jdbc-ucp</code> features to preconfigure a simple JDBC connection in your project, along with a default H2 database driver:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jdbc-tomcat</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To get started, simply add a dependency to one of the JDBC configurations that corresponds to the implementation you would like to use. Choose one of the following:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-tomcat")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-tomcat&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-hikari")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-hikari&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-dbcp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-dbcp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbc-ucp")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbc-ucp&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You also need to add a JDBC driver dependency to your classpath. For example to add the <a href="http://www.h2database.com">H2 In-Memory Database</a>:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">runtimeOnly(<span class="hljs-string">"com.h2database:h2")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;com.h2database&lt;/groupId&gt;
    &lt;artifactId&gt;h2&lt;/artifactId&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>

<h2 id="jdbc-disable"><a class="anchor" href="#jdbc-disable"></a>4.1 Disable Micronaut JDBC Data Sources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbc/jdbc-disable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can disable Micronaut Data Sources, for example in a test, by setting <code>datasources.&lt;datasource-name&gt;.enabled</code> to <code>false</code>.</p>
</div>
<div class="paragraph">
<p>Please note that such test should have <code>@MicronautTest(transactional = false)</code> because required transaction beans won&#8217;t be available because there is no datasource and connection available in the context.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Micronaut SQL 5.7.0 allowed disabling datasources via setting <code>datasources.enabled</code> to `false. That it is no longer supported. If you have multiple dataousrces you have to disable them all individually.
</td>
</tr>
</table>
</div>

<h2 id="jdbc-connection-pools"><a class="anchor" href="#jdbc-connection-pools"></a>4.2 Configuring JDBC Connection Pools</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbc/jdbc-connection-pools.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>All of the implementation specific parameters can be configured. Effort was made to allow basic configuration to be consistent across the implementations.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hikari: The URL is able to be configured through <code>url</code> in addition to <code>jdbcUrl</code>. The JNDI name can be configured through <code>jndiName</code> in addition to <code>dataSourceJNDI</code>.</p>
</li>
<li>
<p>Tomcat: The JNDI name can be configured through <code>jndiName</code> in addition to <code>dataSourceJNDI</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Several configuration options will be calculated if they are not provided.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The classpath will be searched for an embedded database driver. If found, the URL will be set to the default value for that driver.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Driver Class</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the URL is configured, the driver class will be derived from the URL, otherwise the classpath will be searched for an embedded database driver. If found, the default class name for that driver will be used.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the configured database driver is embedded, the username will be set to "sa"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the configured database driver is embedded, the password will be set to an empty string.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties"></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources.default: {}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">["datasources.default"]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources.default {
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  "datasources.default" {
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources.default": {
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above configuration will result in a single <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html">DataSource</a> bean being registered with the named qualifier of <code>default</code>.</p>
</div>
<div class="paragraph">
<p>If for example, the H2 driver is on the classpath, it is equivalent to the following:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default.url=jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
datasources.default.username=sa
datasources.default.password=
datasources.default.driverClassName=org.h2.Driver</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
    default:
        url: jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
        username: sa
        password: ""
        driverClassName: org.h2.Driver</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  [datasources.default]
    url="jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE"
    username="sa"
    password=""
    driverClassName="org.h2.Driver"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' {
    url = "jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE"
    username = "sa"
    password = ""
    driverClassName = "org.h2.Driver"
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default {
      url = "jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE"
      username = "sa"
      password = ""
      driverClassName = "org.h2.Driver"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": {
      "url": "jdbc:h2:mem:default;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE",
      "username": "sa",
      "password": "",
      "driverClassName": "org.h2.Driver"
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>To use Oracle UCP, provide a configuration similar to the following:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default.url=null
datasources.default.connectionFactoryClassName=oracle.jdbc.pool.OracleDataSource
datasources.default.username=null
datasources.default.password=null
datasources.default.minPoolSize=1
datasources.default.maxPoolSize=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
  default:
    url:
    connectionFactoryClassName: oracle.jdbc.pool.OracleDataSource
    username:
    password:
    minPoolSize: 1
    maxPoolSize: 10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  [datasources.default]
    connectionFactoryClassName="oracle.jdbc.pool.OracleDataSource"
    minPoolSize=1
    maxPoolSize=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' {
    url = null
    connectionFactoryClassName = "oracle.jdbc.pool.OracleDataSource"
    username = null
    password = null
    minPoolSize = 1
    maxPoolSize = 10
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default {
      url = null
      connectionFactoryClassName = "oracle.jdbc.pool.OracleDataSource"
      username = null
      password = null
      minPoolSize = 1
      maxPoolSize = 10
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": {
      "url": null,
      "connectionFactoryClassName": "oracle.jdbc.pool.OracleDataSource",
      "username": null,
      "password": null,
      "minPoolSize": 1,
      "maxPoolSize": 10
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The Oracle UCP is managed by the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/jjuar/oracle/ucp/admin/UniversalConnectionPoolManager.html">UniversalConnectionPoolManager</a>. The manager can be disabled byt setting <code>ucp-manager.enabled</code> to <code>false</code>. Additionally you can enable the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/jjucp/jmx-based-management.html">JMX-Based Management</a> by setting the <code>ucp-manager.jmx.enabled</code> to <code>true</code> and providing the <code>ojdbc8dms.jar</code> and <code>dms.jar</code> dependencies.</p>
</div>
<div class="paragraph">
<p>For a list of other properties able to be configured, simply refer to the implementation that is being used. All setter methods are candidates for configuration.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tomcat</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://tomcat.apache.org/tomcat-9.0-doc/api/org/apache/tomcat/jdbc/pool/PoolProperties.html">PoolProperties</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hikari</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://static.javadoc.io/com.zaxxer/HikariCP/2.7.1/com/zaxxer/hikari/HikariConfig.html">HikariConfig</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apache DBCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://commons.apache.org/proper/commons-dbcp/api-2.1.1/org/apache/commons/dbcp2/BasicDataSource.html">BasicDataSource</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oracle UCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://docs.oracle.com/en/database/oracle/oracle-database/21/jjuar/oracle/ucp/jdbc/PoolDataSource.html">PoolDataSource</a></p></td>
</tr>
</tbody>
</table>

<h2 id="jdbc-multiple-datasources"><a class="anchor" href="#jdbc-multiple-datasources"></a>4.3 Configuring Multiple Data Sources</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbc/jdbc-multiple-datasources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To register more than one data source, simply configure them under different names.</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default=...
datasources.warehouse=...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
    default:
        ...
    warehouse:
        ...</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  default="..."
  warehouse="..."</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' = "..."
  warehouse = "..."
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default = "..."
    warehouse = "..."
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": "...",
    "warehouse": "..."
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>When injecting <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.sql/javax/sql/DataSource.html">DataSource</a> beans, the one with the name "default" will be injected unless the injection is qualified with the configured name. If no configuration is named "default", none of the beans will be primary and thus all injections must be qualified. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject DataSource dataSource // "default" will be injected
@Inject @Named("warehouse") DataSource dataSource // "warehouse" will be injected</code></pre>
</div>
</div>

<h2 id="jdbc-healthchecks"><a class="anchor" href="#jdbc-healthchecks"></a>4.4 JDBC Health Checks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbc/jdbc-healthchecks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Once you have configured a JDBC <code>DataSource</code> the <a href="https://docs.micronaut.io/latest/api/io/micronaut/management/health/indicator/jdbc/JdbcIndicator.html">JdbcIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="https://docs.micronaut.io/latest/api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the JDBC connection.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="https://docs.micronaut.io/latest/guide/index.html#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>

<h1 id="hibernate"><a class="anchor" href="#hibernate"></a>5 Configuring Hibernate</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_setting_up_a_hibernatejpa_entitymanager">Setting up a Hibernate/JPA EntityManager</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>hibernate-jpa</code> feature to include a Hibernate JPA configuration in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features hibernate-jpa</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Micronaut features built in support for configuring a <a href="http://hibernate.org">Hibernate</a> / JPA <code>EntityManager</code> that builds on the <a href="#jdbc">SQL DataSource support</a>.</p>
</div>
<div class="paragraph">
<p>Once you have <a href="#jdbc">configured one or many DataSources</a> to use Hibernate, you will need to add the <code>hibernate-jpa</code> dependency to your build configuration:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-hibernate-jpa")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-jpa&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>and the Micronaut Data Transaction Hibernate dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-tx-hibernate")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-tx-hibernate&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>And that is it. For each registered SQL <code>DataSource</code>, Micronaut will configure the following beans using <a href="../api/io/micronaut/configuration/hibernate/jpa/EntityManagerFactoryBean.html">EntityManagerFactoryBean</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/registry/StandardServiceRegistry.html">StandardServiceRegistry</a> - The Hibernate <code>StandardServiceRegistry</code></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/MetadataSources.html">MetadataSources</a> - The Hibernate <code>MetadataSources</code></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/SessionFactoryBuilder.html">SessionFactoryBuilder</a> - The Hibernate <code>SessionFactoryBuilder</code></p>
</li>
<li>
<p><a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/SessionFactory.html">SessionFactory</a> - The Hibernate <code>SessionFactory</code> bean which also implements the JPA <code>EntityManagerFactory</code> interface.</p>
</li>
</ul>
</div>
</div>

<h2 id="hibernate-disable"><a class="anchor" href="#hibernate-disable"></a>5.1 Disable Micronaut Hibernate JPA</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-disable.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can disable Micronaut Hibernate JPA, for example in a test, by setting <code>jpa.enabled</code> to <code>false</code>.</p>
</div>

<h2 id="hibernate-inject-session"><a class="anchor" href="#hibernate-inject-session"></a>5.2 Injecting an EntityManager or Hibernate Session</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-inject-session.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can use the <code>javax.persistence.PersistenceContext</code> annotation to inject an <code>EntityManager</code> (or Hibernate <code>Session</code>). To do so you need to make sure the JPA annotations are on the <code>annotationProcessor</code> path in your build:</p>
</div>
<div class="listingblock">
<div class="title">Adding the JPA dependency to <code>annotationProcessor</code> in Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">annotationProcessor "jakarta.persistence:jakarta.persistence-api:2.2"</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Using <code>@PersistenceContext</code></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@PersistenceContext
EntityManager entityManager;

@PersistenceContext(name = "other")
EntityManager otherManager;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Micronaut will inject a compile time scoped proxy that retrieves the <code>EntityManager</code> associated with the current transaction when using <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> (see "Using Spring Transaction Management" below).</p>
</div>
<div class="paragraph">
<p>Note the examples above use field injection, since the <code>@PersistenceContext</code> annotation does not support declaration on a parameter of a constructor or method argument. Therefore if you wish to instead use constructor or method injection you must use the <a href="../api/io/micronaut/configuration/hibernate/jpa/scope/CurrentSession.html">@CurrentSession</a> instead:</p>
</div>
<div class="listingblock">
<div class="title">Using <code>@CurrentSession</code> for constructor injection</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public MyService(@CurrentSession EntityManager entityManager) {
     this.entityManager = entityManager;
}</code></pre>
</div>
</div>

<h2 id="hibernate-customizing"><a class="anchor" href="#hibernate-customizing"></a>5.3 Customizing Hibernate/JPA Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-customizing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>There are several different ways you can customize and configure how the <code>SessionFactory</code> is built. The easiest way is via configuration. The following configuration demonstrates an example:</p>
</div>
<div class="openblock">
<div class="title">Configuring Hibernate Properties</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">datasources.default.name=mydb
jpa.default.entity-scan.packages[0]=foo.bar
jpa.default.entity-scan.packages[1]=foo.baz
jpa.default.properties.hibernate.hbm2ddl.auto=update
jpa.default.properties.hibernate.show_sql=true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">datasources:
    default:
        name: 'mydb'
jpa:
    default:
        entity-scan:
            packages:
                - 'foo.bar'
                - 'foo.baz'
        properties:
            hibernate:
                hbm2ddl:
                    auto: update
                show_sql: true</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[datasources]
  [datasources.default]
    name="mydb"
[jpa]
  [jpa.default]
    [jpa.default.entity-scan]
      packages=[
        "foo.bar",
        "foo.baz"
      ]
    [jpa.default.properties]
      [jpa.default.properties.hibernate]
        show_sql=true
        [jpa.default.properties.hibernate.hbm2ddl]
          auto="update"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">datasources {
  'default' {
    name = "mydb"
  }
}
jpa {
  'default' {
    entityScan {
      packages = ["foo.bar", "foo.baz"]
    }
    properties {
      hibernate {
        hbm2ddl {
          auto = "update"
        }
        show_sql = true
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  datasources {
    default {
      name = "mydb"
    }
  }
  jpa {
    default {
      entity-scan {
        packages = ["foo.bar", "foo.baz"]
      }
      properties {
        hibernate {
          hbm2ddl {
            auto = "update"
          }
          show_sql = true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "datasources": {
    "default": {
      "name": "mydb"
    }
  },
  "jpa": {
    "default": {
      "entity-scan": {
        "packages": ["foo.bar", "foo.baz"]
      },
      "properties": {
        "hibernate": {
          "hbm2ddl": {
            "auto": "update"
          },
          "show_sql": true
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above example configures the packages to be scanned and sets properties to be passed to Hibernate. As you can see these are done on a per <code>DataSource</code> basis. Refer to the <a href="../api/io/micronaut/configuration/hibernate/jpa/JpaConfiguration.html">JpaConfiguration</a> configuration class for the possible options.</p>
</div>
<div class="paragraph">
<p>If you need even further control over how the <code>SessionFactory</code> is built then you can register <a href="../api/io/micronaut/context/event/BeanCreatedEventListener.html">BeanCreatedEventListener</a> beans that listen for the creation of the <a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/SessionFactoryBuilder.html">SessionFactoryBuilder</a>, <a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/boot/MetadataSources.html">MetadataSources</a> etc. and apply your custom configuration in the listener.</p>
</div>
<div class="paragraph">
<p>You may also optionally create beans of type <a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/integrator/spi/Integrator.html">Integrator</a> and <a href="https://docs.jboss.org/hibernate/orm/current/javadocs/org/hibernate/Interceptor.html">Interceptor</a> and these will be picked up and injected automatically.</p>
</div>

<h2 id="hibernate-entity-scan"><a class="anchor" href="#hibernate-entity-scan"></a>5.4 Entity Scan Configuration</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-entity-scan.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Since 1.2 of this library Entity scan configuration is more flexible and it is possible to do reflection free scanning that works on GraalVM substrate.</p>
</div>
<div class="paragraph">
<p>The default configuration will look for all classes compiled by Micronaut that include the <code>@Entity</code> annotation.</p>
</div>
<div class="paragraph">
<p>If you wish to limit the packages to include in a particular JPA entity manager you can do so with the <code>entity-scan</code> configuration option:</p>
</div>
<div class="openblock">
<div class="title">Limiting Entity Scan</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jpa.default.entity-scan.packages[0]=foo.bar</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jpa:
    default:
        entity-scan:
            packages:
                - 'foo.bar'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jpa]
  [jpa.default]
    [jpa.default.entity-scan]
      packages=[
        "foo.bar"
      ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jpa {
  'default' {
    entityScan {
      packages = ["foo.bar"]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jpa {
    default {
      entity-scan {
        packages = ["foo.bar"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jpa": {
    "default": {
      "entity-scan": {
        "packages": ["foo.bar"]
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The above configuration limits the search to only classes in the <code>foo.bar</code> package. Note that if classes are not compiled by Micronaut they will not be found. There are two ways to resolve this, one is to generate introspection metadata for the external classes. For example you can place in this on your <code>Application</code> class:</p>
</div>
<div class="listingblock">
<div class="title">Generating Introspection Metadata for External Classes</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Introspected(packages="foo.bar")</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will generate introspection metadata for all classes in the <code>foo.bar</code> package.</p>
</div>
<div class="paragraph">
<p>If this option doesn&#8217;t work for you, you can instead enable full classpath scanning using the <code>classpath</code> property:</p>
</div>
<div class="openblock">
<div class="title">Enabling Full Classpath Scanning</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jpa.default.entity-scan.classpath=true
jpa.default.entity-scan.packages[0]=foo.bar</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jpa:
    default:
        entity-scan:
            classpath: true
            packages:
                - 'foo.bar'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jpa]
  [jpa.default]
    [jpa.default.entity-scan]
      classpath=true
      packages=[
        "foo.bar"
      ]</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jpa {
  'default' {
    entityScan {
      classpath = true
      packages = ["foo.bar"]
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jpa {
    default {
      entity-scan {
        classpath = true
        packages = ["foo.bar"]
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jpa": {
    "default": {
      "entity-scan": {
        "classpath": true,
        "packages": ["foo.bar"]
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Note that this approach has the following disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is slower, since Micronaut has to search through JAR files and scan class files with ASM</p>
</li>
<li>
<p>It does not work in GraalVM substrate.</p>
</li>
</ul>
</div>

<h2 id="hibernate-reactive"><a class="anchor" href="#hibernate-reactive"></a>5.5 Configuring Hibernate Reactive</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-reactive.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>It&#8217;s possible to use Hibernate Reactive by adding following dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-hibernate-reactive")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-hibernate-reactive&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>and the Micronaut Data Transaction Hibernate dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.data:micronaut-data-tx-hibernate")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.data&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-data-tx-hibernate&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Hibernate Reactive requires Java 11
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To enable reactive session factory JPA configuration needs to have <code>reactive</code> property set to <code>true</code>.
The reactive implementation doesn&#8217;t use traditional JDBC drivers, but instead it uses Vertx Drivers.</p>
</div>
<div class="paragraph">
<p>You can add one of:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.vertx:vertx-mysql-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-mysql-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.vertx:vertx-pg-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-pg-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.vertx:vertx-mssql-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-mssql-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.vertx:vertx-oracle-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.vertx&lt;/groupId&gt;
    &lt;artifactId&gt;vertx-oracle-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>And configure it using properties:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jpa.default.reactive=true
jpa.default.properties.hibernate.connection.url=jdbc:postgresql:database
jpa.default.properties.hibernate.connection.username=myUsername
jpa.default.properties.hibernate.connection.password=myPassword</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jpa:
  default:
    reactive: true
    properties:
      hibernate:
        connection:
          url: jdbc:postgresql:database # Use JDBC style url
          username: myUsername
          password: myPassword</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jpa]
  [jpa.default]
    reactive=true
    [jpa.default.properties]
      [jpa.default.properties.hibernate]
        [jpa.default.properties.hibernate.connection]
          url="jdbc:postgresql:database"
          username="myUsername"
          password="myPassword"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jpa {
  'default' {
    reactive = true
    properties {
      hibernate {
        connection {
          url = "jdbc:postgresql:database"
          username = "myUsername"
          password = "myPassword"
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jpa {
    default {
      reactive = true
      properties {
        hibernate {
          connection {
            url = "jdbc:postgresql:database"
            username = "myUsername"
            password = "myPassword"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jpa": {
    "default": {
      "reactive": true,
      "properties": {
        "hibernate": {
          "connection": {
            "url": "jdbc:postgresql:database",
            "username": "myUsername",
            "password": "myPassword"
          }
        }
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The other option is to include one of the existing Micronaut SQL support libraries:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-vertx-mysql-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-vertx-mysql-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-vertx-pg-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-vertx-pg-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>And configure the client:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">vertx.pg.client.port=5432
vertx.pg.client.host=the-host
vertx.pg.client.database=the-db
vertx.pg.client.user=user
vertx.pg.client.password=secret
vertx.pg.client.max-size=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">vertx:
  pg:
    client:
      port: 5432
      host: 'the-host'
      database: 'the-db'
      user: 'user'
      password: 'secret'
      max-size:  10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[vertx]
  [vertx.pg]
    [vertx.pg.client]
      port=5432
      host="the-host"
      database="the-db"
      user="user"
      password="secret"
      max-size=10</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">vertx {
  pg {
    client {
      port = 5432
      host = "the-host"
      database = "the-db"
      user = "user"
      password = "secret"
      maxSize = 10
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  vertx {
    pg {
      client {
        port = 5432
        host = "the-host"
        database = "the-db"
        user = "user"
        password = "secret"
        max-size = 10
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "vertx": {
    "pg": {
      "client": {
        "port": 5432,
        "host": "the-host",
        "database": "the-db",
        "user": "user",
        "password": "secret",
        "max-size": 10
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>The integration will automatically integrate Vertx driver instance of <code>io.vertx.sqlclient.Pool</code> found in the bean context.</p>
</div>

<h2 id="hibernate-proxies"><a class="anchor" href="#hibernate-proxies"></a>5.6 Using compile-time Hibernate proxies</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-proxies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Hibernate uses a proxy object to implement lazy loading with a default implementation generating a proxy during the runtime.</p>
</div>
<div class="paragraph">
<p>This has a few disadvantages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Runtime class generation can affect startup and runtime performance</p>
</li>
<li>
<p>Environments like GraalVM don&#8217;t support it</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you wish to use lazy entity associations and avoid runtime proxies you can enable compile-time proxies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jpa:
  default:
    compile-time-hibernate-proxies: true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Compile-time proxies require for an entity which needs to have a proxy to be annotated with <code>@GenerateProxy</code>:</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
public class Pet {

    @ManyToOne(fetch = FetchType.LAZY)
    private Owner owner;

    //...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The entity <code>Owner</code> needs to be annotated with <code>@GenerateProxy</code> to have a proxy generated and the compile-time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Entity
@GenerateProxy
public class Owner {
    //...
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Compile-time proxies are enabled by default for GraalVM environment.
</td>
</tr>
</table>
</div>

<h2 id="hibernate-lazy-initialization"><a class="anchor" href="#hibernate-lazy-initialization"></a>5.7 Understanding LazyInitializationException</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/hibernate/hibernate-lazy-initialization.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut is built on Netty which is based on a non-blocking, event loop model. JDBC and Hibernate are blocking APIs and hence when they are used in a Micronaut application the work is shifted to a blocking I/O thread pool.</p>
</div>
<div class="paragraph">
<p>When using <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/transaction/annotation/Transactional.html">@Transactional</a> the Hibernate <code>Session</code> will only be open for the duration of this method execution and then will automatically be closed. This ensures that the blocking operation is kept as short as possible.</p>
</div>
<div class="paragraph">
<p>There is no notion of OpenSessionInView (OSIV) in Micronaut and never will be, since it is <a href="https://vladmihalcea.com/the-open-session-in-view-anti-pattern/">sub-optimal and not recommended</a>. You should optimize the queries that you write to return all the necessary data Micronaut will need to encode your objects into JSON either by using the appropriate join queries or using a <a href="https://vladmihalcea.com/the-best-way-to-map-a-projection-query-to-a-dto-with-jpa-and-hibernate/">data transfer object (DTO)</a>.</p>
</div>
<div class="paragraph">
<p>If you encounter a <code>LazyInitializationException</code> when returning a Hibernate entity from a method it is an indication that your query is suboptimal and you should perform a join.</p>
</div>

<h1 id="jasync"><a class="anchor" href="#jasync"></a>6 Configuring JAsync SQL</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jasync.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports asynchronous access to PostgreSQL and MySQL using <a href="https://github.com/jasync-sql/jasync-sql">jasync-sql</a>, allowing to handle many database connections with a single thread.</p>
</div>

<h2 id="jasync-client"><a class="anchor" href="#jasync-client"></a>6.1 Configuring jasync-sql Client</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jasync/jasync-client.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>jasync-sql</code> feature to configure the Jasync PostgreSQL and MySQL client in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features jasync-sql</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the Jasync client you should first add <code>jasync-sql</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-jasync-sql")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jasync-sql&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You should then configure the <a href="https://github.com/jasync-sql/jasync-sql/wiki/Configuring-and-Managing-Connections"><code>PoolOptions</code></a> of the database server you wish to communicate with:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jasync.client.port=5432
jasync.client.host=the-host
jasync.client.database=the-db
jasync.client.username=test
jasync.client.password=test
jasync.client.maxActiveConnections=5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jasync:
    client:
        port: 5432
        host: the-host
        database: the-db
        username: test
        password: test
        maxActiveConnections: 5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jasync]
  [jasync.client]
    port=5432
    host="the-host"
    database="the-db"
    username="test"
    password="test"
    maxActiveConnections=5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jasync {
  client {
    port = 5432
    host = "the-host"
    database = "the-db"
    username = "test"
    password = "test"
    maxActiveConnections = 5
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jasync {
    client {
      port = 5432
      host = "the-host"
      database = "the-db"
      username = "test"
      password = "test"
      maxActiveConnections = 5
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jasync": {
    "client": {
      "port": 5432,
      "host": "the-host",
      "database": "the-db",
      "username": "test",
      "password": "test",
      "maxActiveConnections": 5
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place then you can inject the <code>com.github.jasync.sql.db.Connection</code> bean. The following is the simplest way to connect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">result = client.sendQuery('SELECT * FROM pg_stat_database').thenApply({ QueryResult resultSet -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    return "Size: ${resultSet.rows.size()}"
}).get()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>client</code> is an instance of the <code>com.github.jasync.sql.db.Connection</code> bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on running queries on using the client please read the "Running queries" section in the documentation of <a href="https://github.com/jasync-sql/jasync-sql/wiki/Executing-Statements">jasync-sql</a>.</p>
</div>
<div class="paragraph">
<p>To use <a href="https://github.com/jasync-sql/jasync-sql/wiki/Interceptors">Jasync query interceptors</a> register beans of type <code>com.github.jasync.sql.db.interceptor.QueryInterceptor</code>.</p>
</div>

<h2 id="jasync-healthchecks"><a class="anchor" href="#jasync-healthchecks"></a>6.2 Database Health Checks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jasync/jasync-healthchecks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>jasync-sql</code> module is activated a <a href="../api/io/micronaut/configuration/jasync/health/JasyncHealthIndicator.html">JasyncHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the connection.</p>
</div>
<div class="paragraph">
<p>The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.jasync.enabled</code> key.</p>
</div>
<div class="paragraph">
<p>See the section on the <a href="https://docs.micronaut.io/latest/guide/index.html#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>

<h1 id="jooq"><a class="anchor" href="#jooq"></a>7 Configuring jOOQ</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jooq.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports automatically configuring <a href="http://www.jooq.org/">jOOQ</a> library for fluent, typesafe SQL query construction.</p>
</div>
<div class="paragraph">
<p>To configure jOOQ library you should first add <code>jooq</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-jooq")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jooq&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You should then <a href="#jdbc">configure one or many DataSources</a>.
For each registered <code>DataSource</code>, Micronaut will configure the following jOOQ beans using <a href="../api/io/micronaut/configuration/jooq/JooqConfigurationFactory.html">JooqConfigurationFactory</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/Configuration.html">Configuration</a> - jOOQ <code>Configuration</code></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/DSLContext.html">DSLContext</a> - jOOQ <code>DSLContext</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If Spring transaction management is in use, it will additionally create the following beans :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/configuration/jooq/JooqExceptionTranslatorProvider.html">JooqExceptionTranslatorProvider</a> for each <code>DataSource</code></p>
</li>
<li>
<p><a href="../api/io/micronaut/configuration/jooq/SpringTransactionProvider.html">SpringTransactionProvider</a> for each Spring <code>PlatformTransactionManager</code></p>
</li>
</ul>
</div>

<h2 id="jooq-dialect"><a class="anchor" href="#jooq-dialect"></a>7.1 Configuring SQL dialect</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jooq/jooq-dialect.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut will attempt to detect database <a href="https://www.jooq.org/javadoc/latest/org/jooq/SQLDialect.html">SQLDialect</a> automatically.</p>
</div>
<div class="paragraph">
<p>If this does not work as desired, SQL dialect can be provided manually via configuration properties. The following example configures dialect for <code>default</code> datasource:</p>
</div>
<div class="openblock">
<div class="title">Configuring SQL dialect</div>
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">jooq.datasources.default.sql-dialect=POSTGRES</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jooq:
    datasources:
        default:
            sql-dialect: 'POSTGRES'</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[jooq]
  [jooq.datasources]
    [jooq.datasources.default]
      sql-dialect="POSTGRES"</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">jooq {
  datasources {
    'default' {
      sqlDialect = "POSTGRES"
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  jooq {
    datasources {
      default {
        sql-dialect = "POSTGRES"
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "jooq": {
    "datasources": {
      "default": {
        "sql-dialect": "POSTGRES"
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>

<h2 id="jooq-provider-beans"><a class="anchor" href="#jooq-provider-beans"></a>7.2 Configuring additional provider beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jooq/jooq-provider-beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can define additional beans which will be used when jOOQ <code>Configuration</code> is created.
Only beans with the same name qualifier as the data source name will be used.</p>
</div>
<div class="paragraph">
<p>Micronaut will look for the following bean types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/conf/Settings.html">Settings</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/TransactionProvider.html">TransactionProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/ConnectionProvider.html">ConnectionProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/ExecutorProvider.html">ExecutorProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/RecordMapperProvider.html">RecordMapperProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/RecordUnmapperProvider.html">RecordUnmapperProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/MetaProvider.html">MetaProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/ConverterProvider.html">ConverterProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/ExecuteListenerProvider.html">ExecuteListenerProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/RecordListenerProvider.html">RecordListenerProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/VisitListenerProvider.html">VisitListenerProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/TransactionListenerProvider.html">TransactionListenerProvider</a></p>
</li>
<li>
<p><a href="https://www.jooq.org/javadoc/latest/org/jooq/DiagnosticsListenerProvider.html">DiagnosticsListenerProvider</a></p>
</li>
</ul>
</div>

<h2 id="jooq-jsonb"><a class="anchor" href="#jooq-jsonb"></a>7.3 Using JsonMapper to convert JSON(B) types</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jooq/jooq-jsonb.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>If you don&#8217;t register bean of type <a href="https://www.jooq.org/javadoc/latest/org/jooq/ConverterProvider.html">ConverterProvider</a> and provide following configuration, <code>JsonConverterProvider</code> will be used, which uses Micronaut configured <code>JsonMapper</code> for converting from and to types JSON and JSONB.</p>
</div>
<div class="listingblock">
<div class="title">Configuring Micronaut Json converter</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">jooq:
    datasources:
        default:
            json-converter-enabled: true</code></pre>
</div>
</div>

<h2 id="jooq-graalvm"><a class="anchor" href="#jooq-graalvm"></a>7.4 GraalVM native image</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jooq/jooq-graalvm.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To use JOOQ in a native image it is necessary to declare the <code>Record</code> classes for reflection.
The easiest way to do it is configure jOOQ to annotate the generated classes with the JPA annotations enabling the
option <code>jpaAnnotations</code>. This way Micronaut will be able to detect them and automatically generate the reflection
configuration that GraalVM needs.</p>
</div>
<div class="paragraph">
<p>For example, if you are using <a href="https://github.com/etiennestuder/gradle-jooq-plugin">this gradle plugin</a> you can add the
following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">jooq {
    devDb(sourceSets.main) {
        ...
        generator {
            ...
            generate {
                jpaAnnotations = true <i class="conum" data-value="1"></i><b>(1)</b>
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Configure jOOQ to generate the JPA annotations.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There is also built-in support for using <a href="https://simpleflatmapper.org/">SimpleFlatMapper</a> with jOOQ in a native-image. No
additional configuration is needed, just adding the SimpleFlatMapper dependency:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"org.simpleflatmapper:sfm-jdbc:8.2.3")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;org.simpleflatmapper&lt;/groupId&gt;
    &lt;artifactId&gt;sfm-jdbc&lt;/artifactId&gt;
    &lt;version&gt;8.2.3&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Find more information in the <a href="https://www.jooq.org/doc/latest/manual/code-generation/codegen-advanced/codegen-config-generate/codegen-generate-annotations">jOOQ documentation</a>.
</td>
</tr>
</table>
</div>

<h1 id="jdbi"><a class="anchor" href="#jdbi"></a>8 Configuring Jdbi</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports automatically configuring <a href="https://jdbi.org/">Jdbi</a> library for convenient, idiomatic access to relational data.</p>
</div>
<div class="paragraph">
<p>To configure the Jdbi library you should first add the <code>jdbi</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-jdbi")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-jdbi&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You should then <a href="#jdbc">configure one or many DataSources</a>.
For each registered <code>DataSource</code>, Micronaut will configure the following Jdbi beans using <a href="../api/io/micronaut/configuration/jdbi/JdbiFactory.html">JdbiFactory</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://jdbi.org/apidocs/org/jdbi/v3/core/Jdbi.html">Jdbi</a> - the <code>Jdbi</code> instance</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If Spring transaction management is in use, it will additionally create the following beans :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../api/io/micronaut/configuration/jdbi/spring/SpringTransactionHandler.html">SpringTransactionHandler</a> for each Spring <code>PlatformTransactionManager</code></p>
</li>
</ul>
</div>

<h2 id="jdbi-provider-beans"><a class="anchor" href="#jdbi-provider-beans"></a>8.1 Configuring additional provider beans</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/jdbi/jdbi-provider-beans.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can define additional beans which will be used when the <code>Jdbi</code> object is created.
Only beans with a <code>Named</code> qualifier name with the same name as the data source name will be used.</p>
</div>
<div class="paragraph">
<p>Micronaut will look for the following bean types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://jdbi.org/apidocs/org/jdbi/v3/core/transaction/TransactionHandler.html">TransactionHandler</a></p>
</li>
<li>
<p><a href="https://jdbi.org/apidocs/org/jdbi/v3/core/statement/StatementBuilderFactory.html">StatementBuilderFactory</a></p>
</li>
<li>
<p><a href="../api/io/micronaut/configuration/jdbi/JdbiCustomizer.html">JdbiCustomizer</a></p>
</li>
</ul>
</div>

<h1 id="vertxmysqlclient"><a class="anchor" href="#vertxmysqlclient"></a>9 Configuring Reactive MySQL Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/vertxmysqlclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports reactive and non-blocking client to connect to MySQL using <a href="https://github.com/eclipse-vertx/vertx-sql-client/tree/master/vertx-mysql-client">vertx-mysql-client</a>, allowing to handle many database connections with a single thread.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>vertx-mysql-client</code> feature to configure the MySQL Vertx client in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features vertx-mysql-client</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the MySQL Vertx client you should first add <code>vertx-mysql-client</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-vertx-mysql-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-vertx-mysql-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You should then configure the URI or <a href="https://vertx.io/docs/vertx-mysql-client/java/"><code>MySQLConnectOptions</code>,<code>PoolOptions</code></a> of the MySQL server you wish to communicate with in <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">vertx:
	mysql:
	    client:
            port: 3306
            host: the-host
            database: the-db
            user: test
            password: test
            maxSize: 5</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also connect to MySQL using <code>uri</code> instead of the other properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place then you can inject the <code>io.vertx.reactivex.mysqlclient.MySQLPool</code> bean. The following is the simplest way to connect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">result = client.query('SELECT * FROM foo').rxExecute().map({ RowSet&lt;Row&gt; rowSet -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    RowIterator&lt;Row&gt; iterator = rowSet.iterator()
    int id = iterator.next().getInteger("id")
    return "id: ${id}"
}).blockingGet()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>client</code> is an instance of the <code>io.vertx.reactivex.mysqlclient.MySQLPool</code> bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on running queries on MySQL using the reactive client please read the "Running queries" section in the documentation of <a href="https://vertx.io/docs/vertx-mysql-client/java/">vertx-mysql-client</a>.</p>
</div>

<h2 id="vertxmysqlclient-healthchecks"><a class="anchor" href="#vertxmysqlclient-healthchecks"></a>9.1 MySQL Health Checks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/vertxmysqlclient/vertxmysqlclient-healthchecks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>vertx-mysql-client</code> module is activated a <a href="../api/io/micronaut/configuration/vertx/mysql/client/health/MySQLClientPoolHealthIndicator.html">MySQLClientPoolHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the MySQL connection.</p>
</div>
<div class="paragraph">
<p>The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.vertx.mysql.client.enabled</code> key.</p>
</div>
<div class="paragraph">
<p>See the section on the &lt;<a href="https://docs.micronaut.io/latest/guide/index.html#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>

<h1 id="vertxpgclient"><a class="anchor" href="#vertxpgclient"></a>10 Configuring Reactive PostgreSQL Client</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/vertxpgclient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Micronaut supports reactive and non-blocking client to connect to PostgreSQL using <a href="https://github.com/eclipse-vertx/vertx-sql-client/blob/master/vertx-pg-client">vertx-pg-client</a>, allowing to handle many database connections with a single thread.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the CLI</div>
<div class="paragraph">
<p>If you are creating your project using the Micronaut CLI, supply the <code>vertx-pg-client</code> feature to configure the PostgreSQL Vertx client in your project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ mn create-app my-app --features vertx-pg-client</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To configure the PostgreSQL Vertx client you should first add <code>vertx-pg-client</code> module to your classpath:</p>
</div>
<div class="paragraph">
<p>        <div class="listingblock multi-language-sample">
<div class="title"></div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-kotlin hljs" data-lang="gradle">implementation(<span class="hljs-string">"io.micronaut.sql:micronaut-vertx-pg-client")</span></code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="maven">&lt;dependency&gt;
    &lt;groupId&gt;io.micronaut.sql&lt;/groupId&gt;
    &lt;artifactId&gt;micronaut-vertx-pg-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div></p>
</div>
<div class="paragraph">
<p>You should then configure the URI or <a href="https://vertx.io/docs/vertx-pg-client/java/"><code>PgConnectOptions</code>,<code>PoolOptions</code></a> of the PostgreSQL server you wish to communicate with:</p>
</div>
<div class="openblock">
<div class="content">
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">vertx.pg.client.port=3306
vertx.pg.client.host=the-host
vertx.pg.client.database=the-db
vertx.pg.client.user=test
vertx.pg.client.password=test
vertx.pg.client.maxSize=5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">vertx:
  pg:
    client:
      port: 3306
      host: the-host
      database: the-db
      user: test
      password: test
      maxSize: 5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-toml hljs" data-lang="toml">[vertx]
  [vertx.pg]
    [vertx.pg.client]
      port=3306
      host="the-host"
      database="the-db"
      user="test"
      password="test"
      maxSize=5</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy-config hljs" data-lang="groovy-config">vertx {
  pg {
    client {
      port = 3306
      host = "the-host"
      database = "the-db"
      user = "test"
      password = "test"
      maxSize = 5
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-hocon hljs" data-lang="hocon">{
  vertx {
    pg {
      client {
        port = 3306
        host = "the-host"
        database = "the-db"
        user = "test"
        password = "test"
        maxSize = 5
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="listingblock multi-language-sample">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json-config hljs" data-lang="json-config">{
  "vertx": {
    "pg": {
      "client": {
        "port": 3306,
        "host": "the-host",
        "database": "the-db",
        "user": "test",
        "password": "test",
        "maxSize": 5
      }
    }
  }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can also connect to PostgreSQL using <code>uri</code> instead of the other properties.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you have the above configuration in place then you can inject the <code>io.vertx.reactivex.pgclient.PgPool</code> bean. The following is the simplest way to connect:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">result = client.query('SELECT * FROM pg_stat_database').rxExecute().map({ RowSet&lt;Row&gt; rowSet -&gt; <i class="conum" data-value="1"></i><b>(1)</b>
    int size = 0
    RowIterator&lt;Row&gt; iterator = rowSet.iterator()
    while (iterator.hasNext()) {
        iterator.next()
        size++
    }
    return "Size: ${size}"
}).blockingGet()</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>client</code> is an instance of the <code>io.vertx.reactivex.pgclient.PgPool</code> bean.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information on running queries on Postgres using the reactive client please read the "Running queries" section in the documentation of <a href="https://vertx.io/docs/vertx-pg-client/java/">vertx-pg-client</a>.</p>
</div>

<h2 id="vertxpgclient-healthchecks"><a class="anchor" href="#vertxpgclient-healthchecks"></a>10.1 PostgreSQL Health Checks</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/vertxpgclient/vertxpgclient-healthchecks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>When the <code>vertx-pg-client</code> module is activated a <a href="../api/io/micronaut/configuration/vertx/pg/client/health/PgClientPoolHealthIndicator.html">PgClientPoolHealthIndicator</a> is activated resulting in the <code>/health</code> endpoint and <a href="../api/io/micronaut/health/CurrentHealthStatus.html">CurrentHealthStatus</a> interface resolving the health of the Postgres connection.</p>
</div>
<div class="paragraph">
<p>The only configuration option supported is to enable or disable the indicator by the <code>endpoints.health.vertx.pg.client.enabled</code> key.</p>
</div>
<div class="paragraph">
<p>See the section on the &lt;<a href="https://docs.micronaut.io/latest/guide/index.html#healthEndpoint">Health Endpoint</a> for more information.</p>
</div>

<h1 id="repository"><a class="anchor" href="#repository"></a>11 Repository</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/micronaut-projects/micronaut-sql/edit/5.8.x/src/main/docs/guide/repository.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>You can find the source code of this project in this repository:</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/micronaut-projects/micronaut-sql">https://github.com/micronaut-projects/micronaut-sql</a></p>
</div>

    </div>
</div>

<script type="text/javascript">

</script>
</body>
</html>
